<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
   PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
   "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
   <!-- 
   	Status 
   	판매기일 만료 : 0;
   	판매 승인전 : 40
   	수정 승인전 : 41
   	판매중 : 42
   	세일중 : 43
   	승인전 취소 : 44 
   	판매자에 의한 판매 중단 : 45
   	관리자에 의한 판매 중단 : 46
   	사용자 신고에 의한 판매 중단 : 47
   	수정됨 : 48
    -->
<mapper namespace="mapper.product.ProductMapper">

<resultMap id="productMap" type="vo.Product">
		<id property="productId" column="pt_productid" />
		<result property="sellerId" column="pt_uid" />
		<result property="maxQuantity" column="pt_maxquantity" />
		<result property="sellcnt" column="pt_sellcount" />
		<result property="limitTime" column="pt_limittime"/>
		<result property="registTime" column="pt_registtime" />
		<result property="option" column="pt_option" />
		<result property="commission" column="pt_commission" />
		<result property="imagepath" column="pt_imagepath" />
		<result property="status" column="pt_status" />
</resultMap>

<resultMap id="productLangMap" type="vo.ProductLang">
		<id property="productId" column="pt_productid" />
		<result property="name" column="pt_name" />
		<result property="content" column="pt_content" />
</resultMap>

<resultMap id="productSimpleMap" type="vo.ProductSimple">
		<id property="productId" column="ps_productid" />
		<result property="price" column="ps_price" />
		<result property="thumbnail" column="ps_thumbnail" />
		<result property="status" column="ps_status" />
		<result property="type" column="ps_type" />
</resultMap>

<insert id="registProduct" parameterType="product">
INSERT INTO `editshop`.`product_tb` (
`pt_productid` 
,`pt_uid`
,`pt_maxquantity`
,`pt_sellcount`
,`pt_limittime`
,`pt_registtime`
,`pt_option`
,`pt_commission`
,`pt_imagepath`
,`pt_status`) VALUES (
#{productId}, #{sellerId}, #{maxQuantity}, #{sellcnt}, #{limitTime}, now(), #{option}, #{commission}, #{imagepath}, 40);
</insert>

<insert id="addProductLangEn" parameterType="productLang">
INSERT INTO `editshop`.`product_en_tb` (
`pt_productid`
,`pt_content`
,`pt_name`) VALUES (
#{productid}, #{content}, #{name});
</insert>

<insert id="addProductLangCn" parameterType="productLang">
INSERT INTO `editshop`.`product_cn_tb` (
`pt_productid`
,`pt_content`
,`pt_name`) VALUES (
#{productid}, #{content}, #{name});
</insert>

<insert id="addProductLangJp" parameterType="productLang">
INSERT INTO `editshop`.`product_jp_tb` (
`pt_productid`
,`pt_content`
,`pt_name`) VALUES (
#{productid}, #{content}, #{name});
</insert>

<insert id="addProductLangKr" parameterType="productLang">
INSERT INTO `editshop`.`product_kr_tb` (
`pt_productid`
,`pt_content`
,`pt_name`) VALUES (
#{productid}, #{content}, #{name});
</insert>

<update id="confirmProduct" parameterType="String">
UPDATE `editshop`.`product_tb` 
SET `pt_status`='42' 
WHERE `pt_productid`=#{productId};

</update>

<update id="registProductLangEn" parameterType="productLang">
UPDATE `editshop`.`product_en_tb` 
SET `pt_content`=#{content}
  , `pt_name`=#{name} 
WHERE `pt_productid`=#{productid};
</update>

<update id="registProductLangCn" parameterType="productLang">
UPDATE `editshop`.`product_cn_tb` 
SET `pt_content`=#{content}
  , `pt_name`=#{name} 
WHERE `pt_productid`=#{productid};
</update>

<update id="registProductLangJp" parameterType="productLang">
UPDATE `editshop`.`product_jp_tb` 
SET `pt_content`=#{content}
  , `pt_name`=#{name} 
WHERE `pt_productid`=#{productid};
</update>

<update id="registProductLangKr" parameterType="productLang">
UPDATE `editshop`.`product_kr_tb` 
SET `pt_content`=#{content}
  , `pt_name`=#{name} 
WHERE `pt_productid`=#{productid};
</update>

<update id="cancelRegistProduct" parameterType="String">
UPDATE `editshop`.`product_tb` 
SET `pt_status`='0' 
WHERE `pt_productid`=#{productid};
</update>

<update id="modifyRegistProduct" parameterType="product">
UPDATE `editshop`.`product_tb`
SET `pt_maxquantity` = #{maxQuantity}
		,`pt_sellcount` = #{sellcnt}
		,`pt_option` = #{option}
		,`pt_commission` = #{commission}
		,`pt_imagepath` = #{imagepath}
		,`pt_status`='41' 
WHERE `pt_productid`=#{productId};
</update>

<update id="expireProduct" parameterType="String">
UPDATE `editshop`.`product_tb` 
SET `pt_status`='0' 
WHERE `pt_productid`=#{productid};
</update>

<select id="getAllProduct" resultType="product" resultMap="productMap">
SELECT `pt_productid`
			,`pt_uid`
			,`pt_maxquantity`
			,`pt_sellcount`
			,`pt_limittime`
			,`pt_registtime`
			,`pt_option`
			,`pt_commission`
			,`pt_imagepath`
			,`pt_status`
FROM `product_tb`;
</select>

<select id="getProductSellerId" parameterType="String" resultType="product" resultMap="productMap">
SELECT `pt_productid`
			,`pt_uid`
			,`pt_maxquantity`
			,`pt_sellcount`
			,`pt_limittime`
			,`pt_registtime`
			,`pt_option`
			,`pt_commission`
			,`pt_imagepath`
			,`pt_status`
FROM product_tb
WHERE pt_uid=#{sellerid};
</select>

<select id="getProductByProductId" parameterType="String" resultType="product" resultMap="productMap">
SELECT `pt_productid`
			,`pt_uid`
			,`pt_maxquantity`
			,`pt_sellcount`
			,`pt_limittime`
			,`pt_registtime`
			,`pt_option`
			,`pt_commission`
			,`pt_imagepath`
			,`pt_status`
FROM product_tb
WHERE pt_productid=#{sellerid};
</select>


<!-- 관리자 전용 팔고있는것만 가져오기 -->
<select id="getProductByStatus" parameterType="int" resultType="product" resultMap="productMap">
SELECT `pt_productid`
			,`pt_uid`
			,`pt_maxquantity`
			,`pt_sellcount`
			,`pt_limittime`
			,`pt_registtime`
			,`pt_option`
			,`pt_commission`
			,`pt_imagepath`
			,`pt_status`
FROM product_tb
WHERE pt_status=#{status};
</select>


<!-- 신상목록 가져오기 -->
<select id="getNewArrival" resultType="product" resultMap="productMap">
SELECT `pt_productid`
			,`pt_uid`
			,`pt_maxquantity`
			,`pt_sellcount`
			,`pt_limittime`
			,`pt_registtime`
			,`pt_option`
			,`pt_commission`
			,`pt_imagepath`
			,`pt_status`
FROM product_tb 
WHERE pt_status=42
ORDER BY pt_registtime DESC LIMIT 10;
</select>

<!-- 관리자에 의한 판매 재제 -->
<update id="sanctionForAdmin" parameterType="String">
UPDATE `editshop`.`product_tb` 
SET `pt_status`='46' 
WHERE `pt_productid`=#{productid};
</update>

<!-- 셀러에 의한 판매  재제 -->
<update id="sanctionForSeller">
UPDATE `editshop`.`product_tb` 
SET `pt_status`='45' 
WHERE `pt_productid`=#{productid};
</update>

<!-- 시간 추가하기 -->
<update id="extendProduct" parameterType="product">
UPDATE `editshop`.`product_tb` 
SET `pt_limittime`= #{limitTime} 
WHERE `pt_productid`= #{productId};
</update>

<!-- product에서 expire 하면 불러오는 method -->
<update id="quitProductSimple" parameterType="String">
UPDATE `editshop`.`product_simple_tb` 
SET `ps_status`='0' 
WHERE `ps_productid`=#{productid};
</update>

<!-- 메인화면 신상품 -->
<select id="newArrivalMain" resultType="productSimple" resultMap="productSimpleMap">
SELECT ps_productid as productId, ps_thumbnail, ps_price, ps_type, ps_status
FROM product_simple_tb
INNER JOIN product_tb
				ON pt_productid = ps_productid
WHERE pt_status = 42
ORDER BY pt_registtime DESC LIMIT 3;
</select>

<!-- 메뉴로 클릭시-->
<select id="productByType" parameterType="int" resultType="productSimple" resultMap="productSimpleMap">
SELECT ps_productid as productId, ps_thumbnail, ps_price, ps_type, ps_status
FROM product_simple_tb
WHERE ps_type = #{type}
AND ps_status = 42;
</select>

<!-- 관리자 전용 -->
<select id="productSimpleByStatus" parameterType="int" resultType="productSimple" resultMap="productSimpleMap">
SELECT ps_productid as productId, ps_thumbnail, ps_price, ps_type, ps_status
FROM product_simple_tb
WHERE ps_status = #{status}
</select>

<!-- 셀러로 검색시 -->
<select id="productBySellerId" parameterType="String" resultType="productSimple" resultMap="productSimpleMap">
SELECT ps_productid as productId, ps_thumbnail, ps_price, ps_type, ps_status
FROM product_simple_tb
INNER JOIN product_tb
ON ps_productid = pt_productid
WHERE pt_uid = #{sellerid}
AND ps_status = 42
ORDER BY pt_registtime DESC;
</select>

<!-- product 생성때 같이 생성 -->
<insert id="addProductSimple" parameterType="productSimple">
INSERT INTO `editshop`.`product_simple_tb` (
`ps_productid`
,`ps_price`
,`ps_thumbnail`
,`ps_status`
,`ps_type`) VALUES (
#{productid}, #{price}, #{thumbnail}, 40, #{type});
</insert>

<!-- product 고칠때 같이 고칠것. -->
<update id="modifyProductSimple" parameterType="productSimple">
UPDATE `editshop`.`product_simple_tb` 
SET `ps_price` = #{price}
	 ,`ps_thumbnail` = #{thumbnail}
	 ,`ps_type` = #{type}
	 ,`ps_status`=#{status} 
WHERE `ps_productid`=#{productid};
</update>

<!-- 마지막 제품 번호 가져오기 -->
<select id="lastProductNumber" resultType="String">
SELECT max(pt_productid)
FROM product_tb;
</select>
<!-- 위에까지 test완료 -->
</mapper>